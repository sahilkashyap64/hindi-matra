<!DOCTYPE html>
<html lang="en" x-data="matraTuner()">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hindi Matra Tuner</title>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Baloo 2', cursive;
      padding: 1rem;
      background: #f0f4f8; /* Softer background */
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      color: #333;
    }
    .tuner-card {
      background: white;
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      max-width: 850px; /* Slightly wider for new keys */
      width: 100%;
      text-align: center;
    }
    h1 {
      color: #d35400;
      margin-bottom: 1rem;
    }
    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 2rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }
    select {
      font-family: inherit;
      font-size: 1.2rem;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      border: 2px solid #f39c12;
      background: white;
    }
    .hover-toggle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1rem;
    }
    input[type="checkbox"] {
        width: 1.2em;
        height: 1.2em;
        accent-color: #e67e22;
    }
    .consonant-display {
      font-size: 6rem;
      margin: 1rem 0;
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .animated-output {
      transition: transform 0.2s ease-out;
    }
    .animated-output.pop-in {
      transform: scale(1.2);
    }
    .piano-keys {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin: 2rem 0;
      flex-wrap: wrap;
    }
    .key {
      background: linear-gradient(to bottom, #fff, #f1f1f1);
      border: 2px solid #ccc;
      width: 55px; /* Adjusted width */
      height: 180px;
      border-radius: 0 0 8px 8px;
      box-shadow: 0 5px 8px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      padding-bottom: 0.5rem;
      font-size: 2rem;
      cursor: pointer;
      transition: all 0.15s ease;
      position: relative;
    }
    .key:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 12px rgba(0,0,0,0.15);
    }
    .key.active {
      background: linear-gradient(to bottom, #f1c40f, #e67e22);
      border-color: #c2950c;
      transform: translateY(2px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2) inset;
    }
    .key-label {
      font-weight: bold;
    }
    .key-name {
      font-size: 0.9rem;
      color: #7f8c8d;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }
    .output-container {
      margin-top: 2rem;
      padding: 1.5rem;
      background: #f8f9fa;
      border-radius: 12px;
      border: 2px dashed #f39c12;
    }
    .output {
      font-size: 4rem;
      color: #2c3e50;
      min-height: 80px;
    }
    .tts-status {
      font-size: 0.9rem;
      color: #666;
      margin-top: 0.5rem;
      min-height: 1.2em;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    .key.playing {
      animation: pulse 0.8s infinite ease-in-out;
    }
    .examples {
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid #eee;
    }
    .example-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
        margin: 1rem 0;
    }
    .example-word {
        background: #e9ecef;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 1.2rem;
    }
    .example-word:hover {
        background: #f1c40f;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .example-word .translit {
        font-size: 0.9rem;
        opacity: 0.8;
    }

    @media (max-width: 600px) {
      .tuner-card { padding: 1.5rem; }
      .key { width: 45px; height: 150px; font-size: 1.5rem; }
      .consonant-display { font-size: 4rem; height: 90px; }
      .output { font-size: 3rem; }
      h1 { font-size: 1.8rem; }
      .controls { gap: 1rem; }
    }
  </style>
</head>
<body>
  <div class="tuner-card">
    <h1>Hindi Matra Tuner</h1>

    <div class="controls">
      <div class="consonant-selector">
        <select x-model="baseConsonant" @change="updateOutput()">
          <template x-for="c in consonants" :key="c">
            <option x-text="c"></option>
          </template>
        </select>
      </div>
      <!-- ENHANCEMENT: Added a toggle for hover preview -->
      <div class="hover-toggle">
        <input type="checkbox" id="hover-preview" x-model="isHoverPreview">
        <label for="hover-preview">Preview on Hover</label>
      </div>
    </div>
    
    <div class="consonant-display">
      <!-- ENHANCEMENT: Class binding for better animation -->
      <span x-text="output" class="animated-output" :class="{ 'pop-in': isAnimating }"></span>
    </div>

    <div class="piano-keys">
      <template x-for="key in matraKeys" :key="key">
        <div
          class="key"
          :class="{ 'active': activeMatra === key, 'playing': currentlyPlaying === key }"
          @click="playMatra(key)"
          @mouseenter="if (isHoverPreview) previewMatra(key)"
        >
          <div class="key-name" x-text="matras[key].name"></div>
          <div class="key-label" x-text="matras[key].label"></div>
        </div>
      </template>
    </div>

    <div class="examples">
      <h3>Try these examples:</h3>
      <!-- ENHANCEMENT: Better styled example grid -->
      <div class="example-grid">
        <template x-for="ex in examples" :key="ex.result">
          <div class="example-word" @click="playExample(ex)">
            <span x-text="ex.consonant"></span> +
            <span x-text="ex.matra"></span> =
            <strong x-text="ex.result"></strong>
            <span class="translit" x-text="'(' + ex.translit + ')'"></span>
          </div>
        </template>
      </div>
    </div>

  </div>

  <script>
    function matraTuner() {
      return {
        baseConsonant: 'क',
        output: 'क',
        activeMatra: 'none',
        currentlyPlaying: null,
        isHoverPreview: true,
        isAnimating: false,
        ttsStatus: 'Click a key to hear the sound!',
        consonants: [
          'क','ख','ग','घ','ङ','च','छ','ज','झ','ञ',
          'ट','ठ','ड','ढ','ण','त','थ','द','ध','न',
          'प','फ','ब','भ','म','य','र','ल','व','श','ष','स','ह'
        ],
        matras: {
          none: { label: 'अ', name: "a", suffix: '' },
          aa:   { label: 'ा', name: "ā", suffix: 'ा' },
          i:    { label: 'ि', name: "i", suffix: 'ि'}, 
          ii:   { label: 'ी', name: "ī", suffix: 'ी' },
          u:    { label: 'ु', name: "u", suffix: 'ु' },
          uu:   { label: 'ू', name: "ū", suffix: 'ू' },
          r:    { label: 'ृ', name: "ṛ", suffix: 'ृ' }, // NEW: Added ṛ matra
          e:    { label: 'े', name: "e", suffix: 'े' },
          ai:   { label: 'ै', name: "ai", suffix: 'ै' },
          o:    { label: 'ो', name: "o", suffix: 'ो' },
          au:   { label: 'ौ', name: "au", suffix: 'ौ' },
          an:   { label: 'ं', name: "aṃ", suffix: 'ं' }, // NEW: Added aṃ (Anusvara)
          ah:   { label: 'ः', name: "aḥ", suffix: 'ः' }, // NEW: Added aḥ (Visarga)
        },
        // ENHANCEMENT: More detailed example data for cleaner code & better display
        examples: [
          { consonant: 'क', matra: 'ा', matraKey: 'aa', result: 'का', translit: 'kā' },
          { consonant: 'द', matra: 'ि', matraKey: 'i', result: 'दि', translit: 'di' },
          { consonant: 'न', matra: 'ी', matraKey: 'ii', result: 'नी', translit: 'nī' },
          { consonant: 'प', matra: 'ु', matraKey: 'u', result: 'पु', translit: 'pu' },
          { consonant: 'म', matra: 'ृ', matraKey: 'r', result: 'मृ', translit: 'mṛ' },
          { consonant: 'स', matra: 'ं', matraKey: 'an', result: 'सं', translit: 'saṃ' },
        ],
        
        init() {
          // Check for TTS support on load
          if (!('speechSynthesis' in window)) {
            this.ttsStatus = 'Sorry, your browser does not support Text-to-Speech.';
          }
        },

        get matraKeys() {
          return Object.keys(this.matras);
        },
        updateOutput() {
          // When consonant changes, apply the currently active matra
          this.applyMatra(this.activeMatra, false); // Don't play sound on dropdown change
        },
        applyMatra(key, shouldAnimate = true) {
          const m = this.matras[key];
          // FIX: Correctly handle prepending matras like 'ि'
          this.output = m.prepend
            ? m.suffix + this.baseConsonant
            : this.baseConsonant + m.suffix;
          
          if (shouldAnimate) {
            // ENHANCEMENT: Trigger pop animation
            this.isAnimating = true;
            setTimeout(() => this.isAnimating = false, 200);
          }
        },
        playMatra(key) {
          this.activeMatra = key;
          this.applyMatra(key);
          this.playTTS(this.output, 'hi-IN', key);
        },
        previewMatra(key) {
          this.applyMatra(key);
        },
        playExample(ex) {
          this.baseConsonant = ex.consonant;
          this.activeMatra = ex.matraKey;
          this.applyMatra(ex.matraKey);
          this.playTTS(ex.result, 'hi-IN', ex.matraKey);
        },
        playTTS(text, lang, matraKey) {
          if (!('speechSynthesis' in window)) {
            this.ttsStatus = 'TTS not supported.';
            return;
          }
          // Stop any currently playing utterance
          window.speechSynthesis.cancel();
          const u = new SpeechSynthesisUtterance(text);
          u.lang = lang; // Using 'hi-IN' can sometimes provide a better voice
          u.rate = 0.9;
          
          u.onstart = () => {
            this.ttsStatus = 'Playing…';
            this.currentlyPlaying = matraKey;
          };
          u.onend = () => {
            this.ttsStatus = 'Click a key to hear the sound!';
            this.currentlyPlaying = null;
          };
          u.onerror = e => {
            console.error('SpeechSynthesis Error:', e);
            this.ttsStatus = 'Error playing sound.';
            this.currentlyPlaying = null;
          };
          window.speechSynthesis.speak(u);
        }
      }
    }
  </script>
</body>
</html>
